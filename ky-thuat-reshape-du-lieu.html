<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Thống kê sinh học: Từ lý thuyết đến ứng dụng - 25&nbsp; Kỹ thuật reshape dữ liệu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ky-thuat-kiem-tra-missing-value.html" rel="next">
<link href="./huong-dan-show-all-data-tren-console.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./huong-dan-convert-tu-csv-qua-tsv-trong-r.html">Kỹ thuật xử lý dữ liệu</a></li><li class="breadcrumb-item"><a href="./ky-thuat-reshape-du-lieu.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title"><b>Kỹ thuật reshape dữ liệu</b></span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a><a href="https://thongkesinhhoc.com/">Thống kê sinh học: Từ lý thuyết đến ứng dụng</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Giới thiệu</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./cac-lenh-do-thi-can-ban-su-dung-base-r-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Các lệnh đồ thị căn bản sử dụng Base R Graphics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-ve-do-thi-cot-base-r-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn vẽ đồ thị cột bằng Base R Graphics</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-cach-thay-doi-do-rong-cot-trong-barplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn cách thay đổi độ rộng cột trong barplot</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tinh-huong-base-r-graphics-thuong-gap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><b>Tình huống Base R Graphics thường gặp</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-ve-do-thi-nhieu-truc-y.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn vẽ đồ thị nhiều trục Y</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-ve-do-thi-bang-package-lattice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn vẽ đồ thị bằng package <code>lattice</code></b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./so-sanh-cu-phap-ve-do-thi-qua-cac-package-khac-nhau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title"><b>So sánh cú pháp vẽ đồ thị trong R qua các package khác nhau</b></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./co-so-ly-thuyet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cơ sở lý thuyết</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tai-lieu-chon-loc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><b>Tài liệu chọn lọc</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./khoang-tin-cay.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><b>Khoảng tin cậy là gì?</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-phan-tich-t-test-trong-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn phân tích t-test trong R</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./phan-tich-anova-2-yeu-to-trong-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><b>Phân tích ANOVA 2 yếu tố trong R</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./so-sanh-ket-qua-giua-parametric-va-non-parametric-anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title"><b>So sánh kết quả giữa phân tích parametric và non-parametric ANOVA</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./phan-tich-ancova-trong-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title"><b>Phân tích ANCOVA trong R</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cac-lenh-r-thuong-dung-khi-thuc-hien-thong-ke-mo-ta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title"><b>Các lệnh R thường dùng khi thực hiện thống kê mô tả</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quy-trinh-phan-tich-logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><b>Quy trình phân tích logistic regression</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./khai-niem-bootstrap-qua-vi-du-tinh-trung-binh-mau.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title"><b>Khái niệm về bootstrap qua ví dụ tính trung bình mẫu</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bo-tri-thi-nghiem-toi-uu-hoa-bang-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title"><b>Bố trí thí nghiệm tối ưu hóa bằng R</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow-phan-tich-thong-ke-qua-dataset-iris.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title"><b>Workflow phân tích thống kê qua dataset <code>iris</code> </b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example-partial-least-squares-and-principal-component-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title"><b>Example for Partial Least Squares and Principal Component Regression</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quy-cach-ghi-ky-hieu-toan-hoc-trong-cong-thuc-xac-suat-thong-ke.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title"><b>Quy cách ghi ký hiệu toán học trong công thức xác suất thống kê</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tai-lieu-phan-tich-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title"><b>Tài liệu phân tích PCA</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xay-dung-mo-hinh-GAM-trong-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title"><b>Xây dựng mô hình GAM trong R</b></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Kỹ thuật xử lý dữ liệu</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-convert-tu-csv-qua-tsv-trong-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn convert từ file <code>csv</code> qua <code>tsv</code> trong R</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-cach-lam-tron-so-trong-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn cách làm tròn số trong R</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./huong-dan-show-all-data-tren-console.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn show all data trên console</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ky-thuat-reshape-du-lieu.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title"><b>Kỹ thuật reshape dữ liệu</b></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ky-thuat-kiem-tra-missing-value.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title"><b>Kỹ thuật kiểm tra missing value <code>NA</code></b></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tài liệu tham khảo</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./huong-dan-convert-tu-csv-qua-tsv-trong-r.html">Kỹ thuật xử lý dữ liệu</a></li><li class="breadcrumb-item"><a href="./ky-thuat-reshape-du-lieu.html"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title"><b>Kỹ thuật reshape dữ liệu</b></span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title"><b>Kỹ thuật reshape dữ liệu</b></span></h1>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<section id="sử-dụng-lệnh-reshape-của-base-r" class="level2" data-number="25.1">
<h2 data-number="25.1" class="anchored" data-anchor-id="sử-dụng-lệnh-reshape-của-base-r"><span class="header-section-number">25.1</span> Sử dụng lệnh <code>reshape</code> của base R</h2>
<p><strong>Lệnh <code>stats::reshape</code> này là căn bản của base R giúp chuyển dữ liệu từ long sang wide và ngược lại. Hạn chế là nếu dữ liệu unbalanced thì quá trình chuyển đổi sẽ phức tạp.</strong></p>
<p><strong>Lưu ý là khái niệm <em>semi-long</em> và <em>semi-wide</em> data là nói về các dạng dữ liệu ở trạng thái <code>long</code> và <code>wide</code> chưa triệt để. Còn <em>long</em> và <em>wide</em> nói về dạng dữ liệu ở trạng thái <code>long</code> và <code>wide</code> triệt để. Như vậy cùng 1 bộ dataset khi reshape sẽ có nhiều hơn 1 cách sắp xếp dữ liệu tùy vào nhu cầu phân tích của người dùng (chủ yếu để phù hợp với đặc điểm dữ liệu mà các function trong R yêu cầu khi vẽ đồ thị hay phân tích thống kê).</strong></p>
<!-- ### 1.1 Chuyển dữ liệu từ `wide` về `long` -->
<!-- Ta có dataset dạng `wide`, với mỗi dòng là 1 cá thể khác nhau. Dữ liệu này `ballance`. Giờ chuyển thành dạng `long` như sau. -->
<!-- ```{r, echo=FALSE} -->
<!-- iris[c(1:5, 51:55, 101:105), c(1, 2, 5)] -> df -->
<!-- names(df)[1] <- "length" -->
<!-- names(df)[2] <- "width" -->
<!-- names(df)[3] <- "sample" -->
<!-- row.names(df) <- NULL -->
<!-- df[, c(3, 1, 2)] -> df -->
<!-- ``` -->
<!-- ```{r} -->
<!-- df  -->
<!-- df_long <- reshape(df,  -->
<!--                    varying = list(2:3),  -->
<!--                    v.names = "value",  -->
<!--                    timevar = "variable", -->
<!--                    times = names(df)[2:3],  -->
<!--                    idvar = "sample_id",  -->
<!--                    direction = "long") -->
<!-- df_long -->
<!-- df_long |> dplyr::arrange(sample_id) -> df_long_1 -->
<!-- df_long_1 -> df_long_2 -->
<!-- attributes(df_long_2)$reshapeLong <- NULL -->
<!-- df_long_2 -->
<!-- ``` -->
<!-- Chuyển từ `long` về `wide`. -->
<!-- ```{r} -->
<!-- df_wide <- reshape(df_long_2, -->
<!--                    idvar = c("sample_id"), -->
<!--                    v.names = c("value"), -->
<!--                    timevar = "variable", -->
<!--                    direction = "wide")  -->
<!-- row.names(df_wide) <- NULL -->
<!-- attributes(df_wide)$reshapeWide <- NULL -->
<!-- df_wide[, c(1, 3, 4)] -> df_wide_1 -->
<!-- names(df_wide_1)[2] <- "length" -->
<!-- names(df_wide_1)[3] <- "width" -->
<!-- df_wide_1 -->
<!-- identical(df, df_wide_1) -->
<!-- ``` -->
<!-- ### 1.2 Chuyển dữ liệu từ `wide` về `long` -->
<!-- Để rõ hơn, ở `df` ban đầu ta cần có ký hiệu `origin_id` tương ứng từng dòng. -->
<!-- ```{r} -->
<!-- df -> df_ok -->
<!-- df_ok$origin_id <- c(201:215) -->
<!-- df_ok <- df_ok[, c(4, 1, 2, 3)] -->
<!-- df_ok -->
<!-- ``` -->
<!-- ```{r} -->
<!-- af_long <- reshape(df_ok,  -->
<!--                    varying = list(3:4),  -->
<!--                    v.names = "value",  -->
<!--                    timevar = "variable", -->
<!--                    times = names(df_ok)[3:4],  -->
<!--                    idvar = "sample_id", # tạo ra cột id mới  -->
<!--                    direction = "long") -->
<!-- af_long -->
<!-- row.names(af_long) <- NULL -->
<!-- attributes(af_long)$reshapeLong <- NULL -->
<!-- af_long |> dplyr::arrange(sample_id) -> af_long_1 -->
<!-- af_long_1 -> af_long_2 -->
<!-- af_long_2 -->
<!-- ``` -->
<!-- Chuyển từ `long` về `wide` -->
<!-- ```{r} -->
<!-- # af_wide <- reshape(af_long_2, -->
<!-- #                    idvar = c("sample_id"), -->
<!-- #                    v.names = c("value"), -->
<!-- #                    timevar = "variable", -->
<!-- #                    direction = "wide")  -->
<!-- af_wide <- reshape(af_long_2, -->
<!--                    idvar = c("sample_id", "sample", "origin_id"), -->
<!--                    v.names = c("value"), -->
<!--                    timevar = "variable", -->
<!--                    direction = "wide")  -->
<!-- row.names(af_wide) <- NULL -->
<!-- attributes(af_wide)$reshapeWide <- NULL -->
<!-- af_wide[, c(1, 2, 4, 5)] -> af_wide_1 -->
<!-- names(af_wide_1)[3] <- "length" -->
<!-- names(af_wide_1)[4] <- "width" -->
<!-- af_wide_1 -->
<!-- identical(df_ok, af_wide_1) -->
<!-- ``` -->
<section id="áp-dụng-lệnh-reshape-của-base-r-cho-imbalanced-dataset" class="level3" data-number="25.1.1">
<h3 data-number="25.1.1" class="anchored" data-anchor-id="áp-dụng-lệnh-reshape-của-base-r-cho-imbalanced-dataset"><span class="header-section-number">25.1.1</span> Áp dụng lệnh <code>reshape</code> của base R cho imbalanced dataset</h3>
<p><strong>Ta có dataset ở dạng long, ký hiệu là <code>survey</code> với thông tin như sau. Trong đây thì cột <code>id</code> là mã số người tham gia khảo sát, <code>gender</code> là giới tính, <code>age</code> là tuổi, <code>income</code> là thu nhập và <code>year</code> là năm.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"111"</span>, <span class="st">"111"</span>, <span class="st">"112"</span>, <span class="st">"112"</span>, <span class="st">"112"</span>, </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">"114"</span>, <span class="st">"315"</span>, <span class="st">"315"</span>, <span class="st">"315"</span>, <span class="st">"539"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"female"</span>, <span class="st">"male"</span>, <span class="st">"male"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">56</span>, <span class="dv">58</span>, <span class="dv">29</span>, <span class="dv">31</span>, <span class="dv">33</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="cn">NA</span>, <span class="dv">86</span>, <span class="dv">88</span>, <span class="dv">90</span>, <span class="cn">NA</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">2500</span>, <span class="cn">NA</span>, <span class="dv">400</span>, <span class="dv">540</span>, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="dv">200</span>, <span class="dv">440</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">300</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2012</span>, <span class="dv">2014</span>, <span class="dv">2012</span>, <span class="dv">2014</span>, <span class="dv">2016</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>          <span class="dv">2016</span>, <span class="dv">2012</span>, <span class="dv">2014</span>, <span class="dv">2016</span>, <span class="dv">2016</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(id, gender, age, income, year)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>survey</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender age income year
1  111   male  56   1000 2012
2  111   male  58   2500 2014
3  112 female  29     NA 2012
4  112 female  31    400 2014
5  112 female  33    540 2016
6  114 female  NA    200 2016
7  315   male  86    440 2012
8  315   male  88     NA 2014
9  315   male  90     NA 2016
10 539 female  NA    300 2016</code></pre>
</div>
</div>
<p><strong>Vì <code>id</code> và <code>gender</code> không thay đổi qua các năm ở cùng 1 cá nhân nên khi reshape từ long sang wide ta sẽ giữ lại 2 cột này.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>survey_wide_1 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(survey, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">direction =</span> <span class="st">"wide"</span>, <span class="co"># định vị kiểu spread dữ liệu dạng wide</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">idvar =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"gender"</span>), <span class="co"># giữ lại 2 cột này</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">timevar =</span> <span class="st">"year"</span>, <span class="co"># spread ra theo cột `year`</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"income"</span>) <span class="co"># chọn 2 cột để spread dữ liệu</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                         ) </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>survey_wide_1 <span class="co"># dữ liệu sau khi reshape</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender age.2012 income.2012 age.2014 income.2014 age.2016 income.2016
1  111   male       56        1000       58        2500       NA          NA
3  112 female       29          NA       31         400       33         540
6  114 female       NA          NA       NA          NA       NA         200
7  315   male       86         440       88          NA       90          NA
10 539 female       NA          NA       NA          NA       NA         300</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(survey_wide_1) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(survey_wide_1)<span class="sc">$</span>reshapeWide <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dataset đã làm sạch attributes </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># có thể sắp xếp thứ tự cột cho chuẩn về 1 trật tự thuận tiện cho việc subset sau này</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>survey_wide_1 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   id gender age.2012 income.2012 age.2014 income.2014 age.2016 income.2016
1 111   male       56        1000       58        2500       NA          NA
2 112 female       29          NA       31         400       33         540
3 114 female       NA          NA       NA          NA       NA         200
4 315   male       86         440       88          NA       90          NA
5 539 female       NA          NA       NA          NA       NA         300</code></pre>
</div>
</div>
<p><strong>Như vậy ta có dữ liệu ở dạng wide, giờ nếu chuyển về dạng long thì R sẽ chuyển về dạng <em>long triệt để</em>, rồi sau đó ta mới tìm cách chuyển về dạng <em>semi-long</em> như là dataset <code>survey</code> ban đầu.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>survey_long_1 <span class="ot">&lt;-</span> <span class="fu">reshape</span>(survey_wide_1, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">direction =</span> <span class="st">"long"</span>, <span class="co"># định vị kiểu spread dữ liệu dạng long</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">varying =</span> <span class="fu">list</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>), <span class="co"># xác định các cột được rút lại khi reshape về dạng long</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">v.names =</span> <span class="st">"value"</span>, <span class="co"># tên cột mới chứa giá trị tương ứng</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">timevar =</span> <span class="st">"variable"</span>, <span class="co"># tên cột mới chứa tên của các cột được rút lại theo varying</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">times =</span> <span class="fu">names</span>(survey_wide_1)[<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>], <span class="co"># R căn cứ vào đây để đưa tên cột `variable`</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">idvar =</span> <span class="fu">c</span>(<span class="st">"id"</span>) <span class="co"># nếu trong dataset ban đầu có cột id thì chỉ định luôn, </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#nếu không thì ta cần đặt tên cột `sample_id` </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#để R chỉ ra vị trí các cột sau khi gather</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(survey_long_1) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(survey_long_1)<span class="sc">$</span>reshapeLong <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>survey_long_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender    variable value
1  111   male    age.2012    56
2  112 female    age.2012    29
3  114 female    age.2012    NA
4  315   male    age.2012    86
5  539 female    age.2012    NA
6  111   male income.2012  1000
7  112 female income.2012    NA
8  114 female income.2012    NA
9  315   male income.2012   440
10 539 female income.2012    NA
11 111   male    age.2014    58
12 112 female    age.2014    31
13 114 female    age.2014    NA
14 315   male    age.2014    88
15 539 female    age.2014    NA
16 111   male income.2014  2500
17 112 female income.2014   400
18 114 female income.2014    NA
19 315   male income.2014    NA
20 539 female income.2014    NA
21 111   male    age.2016    NA
22 112 female    age.2016    33
23 114 female    age.2016    NA
24 315   male    age.2016    90
25 539 female    age.2016    NA
26 111   male income.2016    NA
27 112 female income.2016   540
28 114 female income.2016   200
29 315   male income.2016    NA
30 539 female income.2016   300</code></pre>
</div>
</div>
<p><strong>Tiếp tục chuyển <code>survey_long_1</code> về dạng cấu trúc y chang dataset <code>survey</code> ban đầu bằng cách reshape qua dạng wide cho các biến <code>age</code> và <code>income</code>.</strong></p>
<p><strong>Bước 1: Tách ra thành các cột riêng</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(survey_long_1<span class="sc">$</span>variable, <span class="at">split =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>) <span class="ot">-&gt;</span> ok</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ok</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "age"  "2012"

[[2]]
[1] "age"  "2012"

[[3]]
[1] "age"  "2012"

[[4]]
[1] "age"  "2012"

[[5]]
[1] "age"  "2012"

[[6]]
[1] "income" "2012"  

[[7]]
[1] "income" "2012"  

[[8]]
[1] "income" "2012"  

[[9]]
[1] "income" "2012"  

[[10]]
[1] "income" "2012"  

[[11]]
[1] "age"  "2014"

[[12]]
[1] "age"  "2014"

[[13]]
[1] "age"  "2014"

[[14]]
[1] "age"  "2014"

[[15]]
[1] "age"  "2014"

[[16]]
[1] "income" "2014"  

[[17]]
[1] "income" "2014"  

[[18]]
[1] "income" "2014"  

[[19]]
[1] "income" "2014"  

[[20]]
[1] "income" "2014"  

[[21]]
[1] "age"  "2016"

[[22]]
[1] "age"  "2016"

[[23]]
[1] "age"  "2016"

[[24]]
[1] "age"  "2016"

[[25]]
[1] "age"  "2016"

[[26]]
[1] "income" "2016"  

[[27]]
[1] "income" "2016"  

[[28]]
[1] "income" "2016"  

[[29]]
[1] "income" "2016"  

[[30]]
[1] "income" "2016"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(rbind, ok) <span class="ot">-&gt;</span> ok_1</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>ok_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]     [,2]  
 [1,] "age"    "2012"
 [2,] "age"    "2012"
 [3,] "age"    "2012"
 [4,] "age"    "2012"
 [5,] "age"    "2012"
 [6,] "income" "2012"
 [7,] "income" "2012"
 [8,] "income" "2012"
 [9,] "income" "2012"
[10,] "income" "2012"
[11,] "age"    "2014"
[12,] "age"    "2014"
[13,] "age"    "2014"
[14,] "age"    "2014"
[15,] "age"    "2014"
[16,] "income" "2014"
[17,] "income" "2014"
[18,] "income" "2014"
[19,] "income" "2014"
[20,] "income" "2014"
[21,] "age"    "2016"
[22,] "age"    "2016"
[23,] "age"    "2016"
[24,] "age"    "2016"
[25,] "age"    "2016"
[26,] "income" "2016"
[27,] "income" "2016"
[28,] "income" "2016"
[29,] "income" "2016"
[30,] "income" "2016"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>survey_long_1<span class="sc">$</span>chi_tieu_theo_doi <span class="ot">&lt;-</span> ok_1[, <span class="dv">1</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>survey_long_1<span class="sc">$</span>year <span class="ot">&lt;-</span> ok_1[, <span class="dv">2</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>survey_long_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender    variable value chi_tieu_theo_doi year
1  111   male    age.2012    56               age 2012
2  112 female    age.2012    29               age 2012
3  114 female    age.2012    NA               age 2012
4  315   male    age.2012    86               age 2012
5  539 female    age.2012    NA               age 2012
6  111   male income.2012  1000            income 2012
7  112 female income.2012    NA            income 2012
8  114 female income.2012    NA            income 2012
9  315   male income.2012   440            income 2012
10 539 female income.2012    NA            income 2012
11 111   male    age.2014    58               age 2014
12 112 female    age.2014    31               age 2014
13 114 female    age.2014    NA               age 2014
14 315   male    age.2014    88               age 2014
15 539 female    age.2014    NA               age 2014
16 111   male income.2014  2500            income 2014
17 112 female income.2014   400            income 2014
18 114 female income.2014    NA            income 2014
19 315   male income.2014    NA            income 2014
20 539 female income.2014    NA            income 2014
21 111   male    age.2016    NA               age 2016
22 112 female    age.2016    33               age 2016
23 114 female    age.2016    NA               age 2016
24 315   male    age.2016    90               age 2016
25 539 female    age.2016    NA               age 2016
26 111   male income.2016    NA            income 2016
27 112 female income.2016   540            income 2016
28 114 female income.2016   200            income 2016
29 315   male income.2016    NA            income 2016
30 539 female income.2016   300            income 2016</code></pre>
</div>
</div>
<p><strong>Bước 2: Sắp xếp dataset gọn gàng trước khi reshape qua dạng wide. Ta thấy R đã chuẩn lại về cho <em>ballance</em> bộ dataset, tức là các giá trị id đều đầy đủ số liệu theo năm.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>survey_long_2 <span class="ot">&lt;-</span> survey_long_1[, <span class="sc">-</span><span class="dv">3</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>survey_long_2 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(id, year) <span class="ot">-&gt;</span> survey_long_2</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>survey_long_2[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>)] <span class="ot">-&gt;</span> survey_long_2</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>survey_long_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender chi_tieu_theo_doi value year
1  111   male               age    56 2012
2  111   male            income  1000 2012
3  111   male               age    58 2014
4  111   male            income  2500 2014
5  111   male               age    NA 2016
6  111   male            income    NA 2016
7  112 female               age    29 2012
8  112 female            income    NA 2012
9  112 female               age    31 2014
10 112 female            income   400 2014
11 112 female               age    33 2016
12 112 female            income   540 2016
13 114 female               age    NA 2012
14 114 female            income    NA 2012
15 114 female               age    NA 2014
16 114 female            income    NA 2014
17 114 female               age    NA 2016
18 114 female            income   200 2016
19 315   male               age    86 2012
20 315   male            income   440 2012
21 315   male               age    88 2014
22 315   male            income    NA 2014
23 315   male               age    90 2016
24 315   male            income    NA 2016
25 539 female               age    NA 2012
26 539 female            income    NA 2012
27 539 female               age    NA 2014
28 539 female            income    NA 2014
29 539 female               age    NA 2016
30 539 female            income   300 2016</code></pre>
</div>
</div>
<p><strong>Bước 3: Reshape trở về dạng wide để giống như dataset <code>survey</code> ban đầu.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>survey_wide_ok <span class="ot">&lt;-</span> <span class="fu">reshape</span>(survey_long_2, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">direction =</span> <span class="st">"wide"</span>, <span class="co"># định vị kiểu spread dữ liệu dạng wide</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">idvar =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"gender"</span>, <span class="st">"year"</span>), <span class="co"># giữ lại 3 cột này</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">timevar =</span> <span class="st">"chi_tieu_theo_doi"</span>, <span class="co"># spread ra theo cột `chi_tieu_theo_doi`</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">v.names =</span> <span class="fu">c</span>(<span class="st">"value"</span>) <span class="co"># chọn cột này để spread dữ liệu</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                         ) </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(survey_wide_ok) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(survey_wide_ok)<span class="sc">$</span>reshapeWide <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>survey_wide_ok</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender year value.age value.income
1  111   male 2012        56         1000
2  111   male 2014        58         2500
3  111   male 2016        NA           NA
4  112 female 2012        29           NA
5  112 female 2014        31          400
6  112 female 2016        33          540
7  114 female 2012        NA           NA
8  114 female 2014        NA           NA
9  114 female 2016        NA          200
10 315   male 2012        86          440
11 315   male 2014        88           NA
12 315   male 2016        90           NA
13 539 female 2012        NA           NA
14 539 female 2014        NA           NA
15 539 female 2016        NA          300</code></pre>
</div>
</div>
<p><strong>Bước 4: Sửa lại tên cột.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>survey_wide_ok_1 <span class="ot">&lt;-</span> survey_wide_ok[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">3</span>)]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(survey_wide_ok_1)[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"age"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(survey_wide_ok_1)[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">"income"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>survey_wide_ok_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender age income year
1  111   male  56   1000 2012
2  111   male  58   2500 2014
3  111   male  NA     NA 2016
4  112 female  29     NA 2012
5  112 female  31    400 2014
6  112 female  33    540 2016
7  114 female  NA     NA 2012
8  114 female  NA     NA 2014
9  114 female  NA    200 2016
10 315   male  86    440 2012
11 315   male  88     NA 2014
12 315   male  90     NA 2016
13 539 female  NA     NA 2012
14 539 female  NA     NA 2014
15 539 female  NA    300 2016</code></pre>
</div>
</div>
<p><strong>Bước 5: Loại bỏ missing value và kiểm tra identical với <code>survey</code> ban đầu.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">complete.cases</span>(survey_wide_ok_1<span class="sc">$</span>age) <span class="ot">-&gt;</span> check_1</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">complete.cases</span>(survey_wide_ok_1<span class="sc">$</span>income) <span class="ot">-&gt;</span> check_2</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>check_1 <span class="sc">|</span> check_2 <span class="ot">-&gt;</span> check_3 <span class="co"># dùng OR để chọn cả 2 FALSE</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># để loại missing value ở 2 cột `age` và `income`</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>survey_wide_ok_1[check_3, ] <span class="ot">-&gt;</span> survey_wide_ok_2</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(survey_wide_ok_2) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># lưu ý là cột `year` cần chuyển về numeric</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>survey_wide_ok_2<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(survey_wide_ok_2<span class="sc">$</span>year)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># setdiff(survey, survey_wide_ok_2)</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>survey_wide_ok_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender age income year
1  111   male  56   1000 2012
2  111   male  58   2500 2014
3  112 female  29     NA 2012
4  112 female  31    400 2014
5  112 female  33    540 2016
6  114 female  NA    200 2016
7  315   male  86    440 2012
8  315   male  88     NA 2014
9  315   male  90     NA 2016
10 539 female  NA    300 2016</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>survey</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender age income year
1  111   male  56   1000 2012
2  111   male  58   2500 2014
3  112 female  29     NA 2012
4  112 female  31    400 2014
5  112 female  33    540 2016
6  114 female  NA    200 2016
7  315   male  86    440 2012
8  315   male  88     NA 2014
9  315   male  90     NA 2016
10 539 female  NA    300 2016</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nếu ở bước này nhìn dataset đã giống nhau rồi mà </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># identical vẫn false thì ta sắp xếp toàn bộ </span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#các cột trong dataset về cùng 1 cấu trúc sau đó mới so sánh</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(survey, survey_wide_ok_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p><strong>Bước 6 (nếu kỹ hơn): Chuẩn lại toàn bộ thứ tự thành phần trong dataset</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>survey <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="sc">!!!</span> rlang<span class="sc">::</span><span class="fu">syms</span>(<span class="fu">names</span>(survey))) <span class="ot">-&gt;</span> survey_chuan</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>survey_chuan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    id gender age income year
1  111   male  56   1000 2012
2  111   male  58   2500 2014
3  112 female  29     NA 2012
4  112 female  31    400 2014
5  112 female  33    540 2016
6  114 female  NA    200 2016
7  315   male  86    440 2012
8  315   male  88     NA 2014
9  315   male  90     NA 2016
10 539 female  NA    300 2016</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>survey_wide_ok_2 <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="sc">!!!</span> rlang<span class="sc">::</span><span class="fu">syms</span>(<span class="fu">names</span>(survey_wide_ok_2))) <span class="ot">-&gt;</span> survey_wide_ok_2_chuan</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(survey_chuan, survey_wide_ok_2_chuan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="các-tình-huống-reshape-thường-gặp" class="level2" data-number="25.2">
<h2 data-number="25.2" class="anchored" data-anchor-id="các-tình-huống-reshape-thường-gặp"><span class="header-section-number">25.2</span> Các tình huống reshape thường gặp</h2>
<section id="chuyển-dữ-liệu-từ-hàng-ngang-sang-hàng-dọc" class="level3" data-number="25.2.1">
<h3 data-number="25.2.1" class="anchored" data-anchor-id="chuyển-dữ-liệu-từ-hàng-ngang-sang-hàng-dọc"><span class="header-section-number">25.2.1</span> Chuyển dữ liệu từ hàng ngang sang hàng dọc</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df_cor_small <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"df_cor_small.rds"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>df_cor_small</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         SV   DT Sex K12Toan K12Van K12NN K12Ly K12Hoa
1  22010001 Kinh Nam     8.2    7.5   9.1   8.4    8.6
2  22010002 Kinh  Nữ     9.2    8.4   9.5   9.5    9.1
3  22010003 Kinh  Nữ     8.9    8.8   8.0   8.3    9.2
4  22010004 Kinh  Nữ     9.2    9.1   9.0   8.0    8.1
5  22010005  Tày  Nữ     6.7    7.9   5.9   6.3    7.0
6  22010006 Kinh  Nữ     9.1    8.5   8.4   9.1    9.5
7  22010007 Kinh Nam     9.5    7.5   9.7  10.0    8.2
8  22010008 Kinh  Nữ     9.2    7.2   9.4   9.3    9.2
9  22010009 Kinh  Nữ     8.8    8.0   7.7   8.2    8.4
10 22010010 Kinh  Nữ     7.2    5.6   7.6   7.8    7.8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>long_df <span class="ot">&lt;-</span> tidyr<span class="sc">:::</span><span class="fu">pivot_longer</span>(df_cor_small, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>), <span class="co"># vị trí các cột cần rã về dạng long</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Lệnh này tìm kiếm theo tên cột</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># bản chất là dùng function grep()</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># cols = starts_with("K12"),</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">"Test"</span>, </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">"Score"</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>long_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(long_df)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>long_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         SV   DT Sex    Test Score
1  22010001 Kinh Nam K12Toan   8.2
2  22010001 Kinh Nam  K12Van   7.5
3  22010001 Kinh Nam   K12NN   9.1
4  22010001 Kinh Nam   K12Ly   8.4
5  22010001 Kinh Nam  K12Hoa   8.6
6  22010002 Kinh  Nữ K12Toan   9.2
7  22010002 Kinh  Nữ  K12Van   8.4
8  22010002 Kinh  Nữ   K12NN   9.5
9  22010002 Kinh  Nữ   K12Ly   9.5
10 22010002 Kinh  Nữ  K12Hoa   9.1
11 22010003 Kinh  Nữ K12Toan   8.9
12 22010003 Kinh  Nữ  K12Van   8.8
13 22010003 Kinh  Nữ   K12NN   8.0
14 22010003 Kinh  Nữ   K12Ly   8.3
15 22010003 Kinh  Nữ  K12Hoa   9.2
16 22010004 Kinh  Nữ K12Toan   9.2
17 22010004 Kinh  Nữ  K12Van   9.1
18 22010004 Kinh  Nữ   K12NN   9.0
19 22010004 Kinh  Nữ   K12Ly   8.0
20 22010004 Kinh  Nữ  K12Hoa   8.1
21 22010005  Tày  Nữ K12Toan   6.7
22 22010005  Tày  Nữ  K12Van   7.9
23 22010005  Tày  Nữ   K12NN   5.9
24 22010005  Tày  Nữ   K12Ly   6.3
25 22010005  Tày  Nữ  K12Hoa   7.0
26 22010006 Kinh  Nữ K12Toan   9.1
27 22010006 Kinh  Nữ  K12Van   8.5
28 22010006 Kinh  Nữ   K12NN   8.4
29 22010006 Kinh  Nữ   K12Ly   9.1
30 22010006 Kinh  Nữ  K12Hoa   9.5
31 22010007 Kinh Nam K12Toan   9.5
32 22010007 Kinh Nam  K12Van   7.5
33 22010007 Kinh Nam   K12NN   9.7
34 22010007 Kinh Nam   K12Ly  10.0
35 22010007 Kinh Nam  K12Hoa   8.2
36 22010008 Kinh  Nữ K12Toan   9.2
37 22010008 Kinh  Nữ  K12Van   7.2
38 22010008 Kinh  Nữ   K12NN   9.4
39 22010008 Kinh  Nữ   K12Ly   9.3
40 22010008 Kinh  Nữ  K12Hoa   9.2
41 22010009 Kinh  Nữ K12Toan   8.8
42 22010009 Kinh  Nữ  K12Van   8.0
43 22010009 Kinh  Nữ   K12NN   7.7
44 22010009 Kinh  Nữ   K12Ly   8.2
45 22010009 Kinh  Nữ  K12Hoa   8.4
46 22010010 Kinh  Nữ K12Toan   7.2
47 22010010 Kinh  Nữ  K12Van   5.6
48 22010010 Kinh  Nữ   K12NN   7.6
49 22010010 Kinh  Nữ   K12Ly   7.8
50 22010010 Kinh  Nữ  K12Hoa   7.8</code></pre>
</div>
</div>
</section>
<section id="chuyển-dữ-liệu-từ-hàng-dọc-sang-hàng-ngang" class="level3" data-number="25.2.2">
<h3 data-number="25.2.2" class="anchored" data-anchor-id="chuyển-dữ-liệu-từ-hàng-dọc-sang-hàng-ngang"><span class="header-section-number">25.2.2</span> Chuyển dữ liệu từ hàng dọc sang hàng ngang</h3>
<p><strong>Trường hợp 1: Dữ liệu đơn giản</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ok_1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ok_1.rds"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>ok_1_short <span class="ot">&lt;-</span> ok_1[ , <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>ok_1_short</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   NAME       variable estimate
   &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
 1 Alabama    income      24476
 2 Alabama    rent          747
 3 Alaska     income      32940
 4 Alaska     rent         1200
 5 Arizona    income      27517
 6 Arizona    rent          972
 7 Arkansas   income      23789
 8 Arkansas   rent          709
 9 California income      29454
10 California rent         1358</code></pre>
</div>
</div>
<p><strong>Ta chuyển qua dạng wide</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ok_1_short <span class="sc">|&gt;</span> tidyr<span class="sc">:::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="fu">c</span>(variable),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="fu">c</span>(estimate)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>) <span class="ot">-&gt;</span> ok_1_wide</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>ok_1_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  NAME       income  rent
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 Alabama     24476   747
2 Alaska      32940  1200
3 Arizona     27517   972
4 Arkansas    23789   709
5 California  29454  1358</code></pre>
</div>
</div>
<p><strong>Nếu muốn chuyển về dạng long thì áp dụng cách sau:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ok_1_long <span class="ot">&lt;-</span> tidyr<span class="sc">:::</span><span class="fu">pivot_longer</span>(ok_1_wide, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"income"</span>, <span class="st">"rent"</span>),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">"variable"</span>, </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">"estimate"</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>ok_1_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   NAME       variable estimate
   &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
 1 Alabama    income      24476
 2 Alabama    rent          747
 3 Alaska     income      32940
 4 Alaska     rent         1200
 5 Arizona    income      27517
 6 Arizona    rent          972
 7 Arkansas   income      23789
 8 Arkansas   rent          709
 9 California income      29454
10 California rent         1358</code></pre>
</div>
</div>
<p><strong>Trường hợp 2: Dữ liệu phức tạp</strong></p>
<p><strong>Chuyển qua dạng wide</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ok_1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ok_1.rds"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>ok_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   GEOID NAME       variable estimate   moe
   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1 01    Alabama    income      24476   136
 2 01    Alabama    rent          747     3
 3 02    Alaska     income      32940   508
 4 02    Alaska     rent         1200    13
 5 04    Arizona    income      27517   148
 6 04    Arizona    rent          972     4
 7 05    Arkansas   income      23789   165
 8 05    Arkansas   rent          709     5
 9 06    California income      29454   109
10 06    California rent         1358     3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ok_1 <span class="sc">|&gt;</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="fu">c</span>(variable),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="fu">c</span>(estimate, moe)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>) <span class="ot">-&gt;</span> ok_1_wide_yes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Nếu muốn chuyển về dạng long</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes <span class="ot">&lt;-</span> tidyr<span class="sc">:::</span><span class="fu">pivot_longer</span>(ok_1_wide_yes, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes <span class="co"># đây là dạng true long</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
   GEOID NAME       variable        value
   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;
 1 01    Alabama    estimate_income 24476
 2 01    Alabama    estimate_rent     747
 3 01    Alabama    moe_income        136
 4 01    Alabama    moe_rent            3
 5 02    Alaska     estimate_income 32940
 6 02    Alaska     estimate_rent    1200
 7 02    Alaska     moe_income        508
 8 02    Alaska     moe_rent           13
 9 04    Arizona    estimate_income 27517
10 04    Arizona    estimate_rent     972
11 04    Arizona    moe_income        148
12 04    Arizona    moe_rent            4
13 05    Arkansas   estimate_income 23789
14 05    Arkansas   estimate_rent     709
15 05    Arkansas   moe_income        165
16 05    Arkansas   moe_rent            5
17 06    California estimate_income 29454
18 06    California estimate_rent    1358
19 06    California moe_income        109
20 06    California moe_rent            3</code></pre>
</div>
</div>
<p><strong>Nếu muốn chuyển về dạng semi-long</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes_a <span class="ot">&lt;-</span> tidyr<span class="sc">:::</span><span class="fu">pivot_longer</span>(ok_1_wide_yes[ , <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">"estimate"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes_a<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">"estimate_"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">replacement =</span> <span class="st">""</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> ok_1_long_yes_a<span class="sc">$</span>variable)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes_b <span class="ot">&lt;-</span> tidyr<span class="sc">:::</span><span class="fu">pivot_longer</span>(ok_1_wide_yes[ , <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">6</span>)], </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">"variable"</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">"moe"</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes_b<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">"moe_"</span>,</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">replacement =</span> <span class="st">""</span>,</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> ok_1_long_yes_b<span class="sc">$</span>variable)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes_b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   GEOID NAME       variable   moe
   &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;
 1 01    Alabama    income     136
 2 01    Alabama    rent         3
 3 02    Alaska     income     508
 4 02    Alaska     rent        13
 5 04    Arizona    income     148
 6 04    Arizona    rent         4
 7 05    Arkansas   income     165
 8 05    Arkansas   rent         5
 9 06    California income     109
10 06    California rent         3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes_final <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> ok_1_long_yes_a,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> ok_1_long_yes_b,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">all =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"NAME"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"variable"</span>))</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>ok_1_long_yes_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   GEOID       NAME variable estimate moe
1     01    Alabama   income    24476 136
2     01    Alabama     rent      747   3
3     02     Alaska   income    32940 508
4     02     Alaska     rent     1200  13
5     04    Arizona   income    27517 148
6     04    Arizona     rent      972   4
7     05   Arkansas   income    23789 165
8     05   Arkansas     rent      709   5
9     06 California   income    29454 109
10    06 California     rent     1358   3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">as.data.frame</span>(ok_1), ok_1_long_yes_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="tham-khảo" class="level3" data-number="25.2.3">
<h3 data-number="25.2.3" class="anchored" data-anchor-id="tham-khảo"><span class="header-section-number">25.2.3</span> Tham khảo</h3>
<ul>
<li><p><code>https://www.magesblog.com/post/2012-02-09-reshape-function/</code></p></li>
<li><p><code>https://search.r-project.org/CRAN/refmans/splitstackshape/html/Reshape.html</code></p></li>
<li><p><code>https://www.mjandrews.org/blog/pivots/</code></p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-page-right">
  <div class="nav-page nav-page-previous">
      <a href="./huong-dan-show-all-data-tren-console.html" class="pagination-link" aria-label="<b>Hướng dẫn show all data trên console</b>">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title"><b>Hướng dẫn show all data trên console</b></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ky-thuat-kiem-tra-missing-value.html" class="pagination-link" aria-label="<b>Kỹ thuật kiểm tra missing value <code>NA</code></b>">
        <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title"><b>Kỹ thuật kiểm tra missing value <code>NA</code></b></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>